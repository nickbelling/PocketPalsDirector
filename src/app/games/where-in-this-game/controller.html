@let state = this.state();
@let questions = this.questions();
@let question = this.currentQuestion();

<div class="layout-column g">
    <question-selector
        [questions]="questions"
        [currentQuestion]="currentQuestion()"
        (currentQuestionChange)="setQuestion($event)"
        (reset)="reset()"
        (addQuestion)="addQuestion()"
        canEdit
        (editQuestion)="editQuestion($event)"
        canDelete
        (deleteQuestion)="deleteQuestion($event)">
        <question-display *question="let question; from: questions">
            <span>{{ question.gameId | gameName }}</span>
        </question-display>
    </question-selector>

    @if (question) {
        <mat-card>
            <mat-card-header>
                <mat-card-title>
                    <span>{{ question.gameId | gameName }}</span>
                </mat-card-title>
            </mat-card-header>
            <mat-card-content class="layout-column g p-y">
                <mat-form-field>
                    <mat-label>Select location</mat-label>
                    <mat-select
                        [ngModel]="state.currentLocation"
                        (selectionChange)="setLocation($event.value)">
                        @for (
                            location of question.locations;
                            track location.locationImageId
                        ) {
                            <mat-option [value]="$index">
                                <span>{{ location.name }}</span>
                            </mat-option>
                        }
                    </mat-select>
                </mat-form-field>

                @for (team of teams(); track team.id) {
                    <mat-form-field>
                        <mat-label>{{ team.name }} guess</mat-label>
                        <mat-icon matPrefix [style.color]="team.color"
                            >location_on</mat-icon
                        >
                        <input
                            matInput
                            required
                            [ngModel]="
                                state.currentGuesses[team.id]
                                    | gridRefString
                                        : [question.columns, question.rows]
                            "
                            (ngModelChange)="updateGuess(team.id, $event)"
                            [disabled]="state.currentLocation === null" />
                    </mat-form-field>
                }

                <button
                    mat-flat-button
                    (click)="updateGuesses()"
                    [disabled]="state.currentLocation === null">
                    <mat-icon>refresh</mat-icon>
                    <span>Update pins</span>
                </button>

                <mat-divider />

                <button
                    mat-flat-button
                    (click)="showAnswer()"
                    [disabled]="state.currentLocation === null">
                    <mat-icon>check_circle</mat-icon>
                    <span>Show answer</span>
                </button>
            </mat-card-content>
        </mat-card>
    }
</div>
