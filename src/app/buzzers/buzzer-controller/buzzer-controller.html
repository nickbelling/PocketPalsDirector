<div class="layout-column g">
    <div class="layout-row g">
        <button mat-flat-button (click)="addPlayer()">
            <mat-icon>add_circle</mat-icon>
            <span>Add player</span>
        </button>
        <button
            mat-flat-button
            (click)="resetAllBuzzers()"
            [disabled]="!anyPlayersBuzzed()"
        >
            <mat-icon>refresh</mat-icon>
            <span>Reset all</span>
        </button>
        <button
            mat-flat-button
            (click)="unlockAll()"
            [disabled]="!anyPlayersLocked()"
        >
            <mat-icon>lock_open</mat-icon>
            <span>Unlock all</span>
        </button>
    </div>
    <div class="layout-row layout-items-fill g">
        <mat-card>
            <mat-card-header>
                <mat-card-title>Buzzed in players</mat-card-title>
            </mat-card-header>
            <mat-list>
                @for (player of buzzedInPlayers(); track player.firebaseId) {
                    <ng-container
                        *ngTemplateOutlet="
                            playerListItem;
                            context: { $implicit: player }
                        "
                    />
                }
                @for (
                    number of players().length - buzzedInPlayers().length
                        | numberArray;
                    track number
                ) {
                    <mat-list-item></mat-list-item>
                }
            </mat-list>
        </mat-card>
        <mat-card>
            <mat-card-header>
                <mat-card-title>Buzzed out players</mat-card-title>
            </mat-card-header>
            <mat-list>
                @for (player of buzzedOutPlayers(); track player.firebaseId) {
                    <ng-container
                        *ngTemplateOutlet="
                            playerListItem;
                            context: { $implicit: player }
                        "
                    />
                }
            </mat-list>
        </mat-card>
    </div>
    <buzzer-display />
</div>

<ng-template #playerListItem let-untypedPlayer>
    @let player = toPlayer(untypedPlayer);

    <mat-list-item>
        <span>{{ player.name }}</span>
        <div matListItemMeta class="g">
            @if (player.lockedOut) {
                <button
                    mat-mini-fab
                    class="error"
                    (click)="toggleLock(player.firebaseId, true)"
                >
                    <mat-icon>lock</mat-icon>
                </button>
            } @else {
                <button
                    mat-icon-button
                    (click)="toggleLock(player.firebaseId, false)"
                >
                    <mat-icon>lock_open</mat-icon>
                </button>
            }

            @if (player.buzzTimestamp !== null) {
                <button
                    mat-icon-button
                    (click)="resetBuzzer(player.firebaseId)"
                >
                    <mat-icon>refresh</mat-icon>
                </button>
            } @else {
                <button mat-icon-button (click)="buzzIn(player.firebaseId)">
                    <mat-icon>highlight_mouse_cursor</mat-icon>
                </button>
                <button mat-icon-button (click)="deletePlayer(player)">
                    <mat-icon>Delete</mat-icon>
                </button>
            }
        </div>
    </mat-list-item>
</ng-template>
